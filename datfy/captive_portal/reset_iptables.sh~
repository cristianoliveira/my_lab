#!/bin/sh

echo "Flushing iptables rules..."
sleep 1
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT

iptables -A INPUT -i wlan1 -p udp -m udp --dport 67 -j ACCEPT
iptables -A INPUT -i wlan1 -p tcp -m tcp --dport 67 -j ACCEPT
iptables -A INPUT -i wlan1 -p udp -m udp --dport 53 -j ACCEPT
iptables -A INPUT -i wlan1 -p tcp -m tcp --dport 53 -j ACCEPT
iptables -A FORWARD -d 10.42.0.0/24 -o wlan1 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -s 10.42.0.0/24 -i wlan1 -j ACCEPT
iptables -A FORWARD -i wlan1 -o wlan1 -j ACCEPT
iptables -A FORWARD -o wlan1 -j REJECT --reject-with icmp-port-unreachable
iptables -A FORWARD -i wlan1 -j REJECT --reject-with icmp-port-unreachable
# Completed on Sat Oct  4 13:31:46 2014
# Generated by iptables-save v1.4.21 on Sat Oct  4 13:31:46 
iptables -A POSTROUTING -s 10.42.0.0/24 ! -d 10.42.0.0/24 -j MASQUERADE
